<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Prácticas - ESPAM MFL</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <style>
        :root {
            --espam-primary: #005846;
            --espam-secondary: #39b54a;
            --espam-accent: #cbdb2a;
            --espam-light: #08b89d;
            --espam-bg-light: #F8F8F2;
            --espam-font-primary: 'Libertad Mono', 'Work Sans', monospace;
            --espam-font-secondary: 'Work Sans', sans-serif;
        }
        body { font-family: var(--espam-font-secondary); color: #333; }
        h1,h2,h3,h4,h5,h6 { font-family: var(--espam-font-primary); color: var(--espam-primary); }
        .top-bar { background: linear-gradient(135deg, var(--espam-primary) 0%, #004637 100%); color: white; }
        .top-bar h1 { color: white; }
        .sidebar-header { background: linear-gradient(135deg, var(--espam-primary) 0%, #004637 100%); padding: 20px; text-align: center; color: white; border-bottom: 3px solid var(--espam-accent); }
        .sidebar-header h3 { color: white !important; margin: 10px 0 5px 0; }
        .sidebar-menu li.active a { background: var(--espam-primary); color: white; font-weight: 600; }
        .sidebar-menu li a:hover { background: rgba(0,88,70,0.1); color: var(--espam-primary); }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: var(--espam-primary); color: white; padding: 12px 15px; text-align: left; font-weight: 600; }
        .data-table td { padding: 12px 15px; border-bottom: 1px solid var(--espam-bg-light); }
        .data-table tr:hover { background: var(--espam-bg-light); }
        .content-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,88,70,0.1); }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block; }
        .status-disponible, .status-confirmada { background: var(--espam-secondary); color: white; }
        .status-pendiente { background: var(--espam-accent); color: var(--espam-primary); }
        .status-mantenimiento, .status-cancelada, .status-rechazada { background: #dc3545; color: white; }
        .status-en_uso, .status-completada { background: var(--espam-light); color: white; }
        .status-critico, .status-agotado { background: #dc3545; color: white; }
        .status-normal { background: var(--espam-secondary); color: white; }
        .filter-bar { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .filter-bar select, .filter-bar input { padding: 8px 15px; border: 1px solid #ddd; border-radius: 5px; font-family: var(--espam-font-secondary); }
        .filter-bar select:focus, .filter-bar input:focus { outline: none; border-color: var(--espam-primary); }
        .btn-primary-espam { background: var(--espam-primary); color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-primary-espam:hover { background: #004637; }
        .btn-danger-espam { background: #dc3545; color: white; border: none; padding: 6px 15px; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .btn-danger-espam:hover { background: #bd2130; }
        .loading-spinner { text-align: center; padding: 40px; color: var(--espam-primary); }
        .empty-state { text-align: center; padding: 40px; color: #666; }
        .practica-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: #fff; }
        .practica-card:hover { box-shadow: 0 4px 12px rgba(0,88,70,0.15); }
        .practica-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .practica-title { font-size: 1.2rem; font-weight: 600; color: var(--espam-primary); margin: 0; }
        .practica-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .practica-info-item { display: flex; align-items: center; gap: 8px; color: #666; }
        .practica-info-item i { color: var(--espam-primary); }
    </style>
</head>
<body>
    <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo" style="font-family:'Libertad Mono',monospace;font-size:1.5rem;font-weight:bold;color:white;">ESPAM MFL</div>
                <h3>UNIVERSIDAD ESPAM MFL</h3>
                <p class="user-role">Estudiante</p>
            </div>
            <div class="user-profile">
                <div class="user-avatar"><i class="fas fa-user-circle"></i></div>
                <div class="user-info">
                    <h4 id="userName">Estudiante ESPAM</h4>
                    <p id="userDetail">Carrera</p>
                    <span class="user-status online"></span>
                </div>
            </div>
            <nav class="sidebar-menu"><ul>
                <li><a href="dashboard-estudiante.html"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <li><a href="calendario-reservas.html"><i class="fas fa-calendar-alt"></i><span>Calendario de Prácticas</span></a></li>
                <li><a href="hoja-guia.html"><i class="fas fa-file-alt"></i><span>Hojas Guía</span></a></li>
                <li class="active"><a href="mis-practicas.html"><i class="fas fa-clipboard-list"></i><span>Mis Prácticas</span></a></li>
                <li><a href="equipos-estudiante.html"><i class="fas fa-flask"></i><span>Equipos y Sustancias</span></a></li>
                <li><a href="calificar.html"><i class="fas fa-star"></i><span>Calificar Laboratorio</span></a></li>
                <li><a href="notificaciones.html"><i class="fas fa-bell"></i><span>Notificaciones</span></a></li>
                <li><a href="perfil.html"><i class="fas fa-user-cog"></i><span>Perfil</span></a></li>
            </ul></nav>
        </div>

        <div class="main-content">
            <header class="top-bar">
                <div class="top-bar-left">
                    <button class="menu-toggle"><i class="fas fa-bars"></i></button>
                    <h1>Mis Prácticas</h1>
                </div>
                <div class="top-bar-right">
                    <div class="top-bar-actions">
                        <button class="btn-notification"><i class="fas fa-bell"></i><span class="notification-count">0</span></button>
                        <div class="user-dropdown">
                            <button class="btn-user"><i class="fas fa-user-circle"></i><span id="topBarUserName">Usuario</span><i class="fas fa-chevron-down"></i></button>
                            <div class="dropdown-menu">
                                <a href="perfil.html"><i class="fas fa-user"></i> Perfil</a>
                                <div class="divider"></div>
                                <a href="login.html" class="logout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="dashboard-content">
                <div class="content-card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2><i class="fas fa-clipboard-list"></i> Mis Prácticas</h2>
                    </div>
                    <div id="practicasContainer" class="loading-spinner">
                        <i class="fas fa-spinner fa-spin" style="font-size:2rem;"></i>
                        <p>Cargando prácticas...</p>
                    </div>
                </div>
            </div>
        </div>

    <script src="js/dashboard.js"></script>
    <script>
        async function cargarSesion() {
            try {
                const { session, perfil } = await AuthService.getSesion();
                if (session && perfil) {
                    await SessionHelper.guardarSesionLegacy(perfil);
                    if (document.getElementById('userName')) document.getElementById('userName').textContent = perfil.nombre || 'Usuario';
                    if (document.getElementById('userDetail')) document.getElementById('userDetail').textContent = perfil.laboratorio_nombre || perfil.carrera_nombre || '';
                    if (document.getElementById('topBarUserName')) document.getElementById('topBarUserName').textContent = perfil.nombre || 'Usuario';
                    return perfil;
                }
                return SessionHelper.obtenerSesionLegacy();
            } catch (e) {
                console.error('Error cargando sesión:', e);
                return SessionHelper.obtenerSesionLegacy();
            }
        }

        async function cargarPracticas() {
            const container = document.getElementById('practicasContainer');
            try {
                const practicas = await PracticasService.obtenerPracticasEstudiante();
                if (practicas.length === 0) {
                    container.innerHTML = '<div class="empty-state"><i class="fas fa-clipboard-list" style="font-size:3rem;color:#ccc;margin-bottom:15px;"></i><p>No tienes prácticas registradas</p></div>';
                    return;
                }

                let html = '';
                practicas.forEach(p => {
                    const fecha = p.fecha ? new Date(p.fecha).toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : '-';
                    const lab = p.laboratorio_nombre || p.laboratorios?.nombre || '-';
                    const docente = p.docente_nombre || p.usuarios?.nombre || '-';
                    const estado = p.estado || 'pendiente';
                    const titulo = p.titulo || 'Práctica de laboratorio';
                    const descripcion = p.descripcion || 'Sin descripción';

                    html += '<div class="practica-card">';
                    html += '<div class="practica-header">';
                    html += '<h3 class="practica-title">' + titulo + '</h3>';
                    html += '<span class="status-badge status-' + estado + '">' + estado.charAt(0).toUpperCase() + estado.slice(1) + '</span>';
                    html += '</div>';
                    html += '<p style="color:#666;margin-bottom:15px;">' + descripcion + '</p>';
                    html += '<div class="practica-info">';
                    html += '<div class="practica-info-item"><i class="fas fa-calendar"></i><span>' + fecha + '</span></div>';
                    html += '<div class="practica-info-item"><i class="fas fa-flask"></i><span>' + lab + '</span></div>';
                    html += '<div class="practica-info-item"><i class="fas fa-chalkboard-teacher"></i><span>' + docente + '</span></div>';
                    html += '</div>';
                    html += '</div>';
                });

                container.innerHTML = html;
            } catch (e) {
                console.error('Error cargando prácticas:', e);
                container.innerHTML = '<div class="empty-state"><p>Error al cargar prácticas</p></div>';
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            await cargarSesion();
            await cargarPracticas();
        });
    </script>
</body>
</html>
