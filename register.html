<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - UDIV ESPAM MFL</title>
    
    <!-- Tipografía según normativa ESPAM MFL -->
    <link href="https://fonts.googleapis.com/css2?family=Libertinus+Mono:wght@400;700&family=Work+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    
    <style>
        /* ===== PALETA DE COLORES ESPAM MFL ===== */
        :root {
            /* Colores principales según normativa */
            --espam-primary: #005846;      /* Pantone 3308 C - Verde principal */
            --espam-secondary: #39b54a;    /* Verde secundario */
            --espam-accent: #cbdb2a;       /* Pantone 381 C - Amarillo/accent */
            --espam-accent2: #08b89d;      /* Pantone 3265 C - Turquesa */
            --espam-light: #F8F8F2;        /* Pantone 663 C - Fondo claro */
            --espam-dark: #00382b;         /* Verde oscuro para hover */
            
            /* Variables para uso general */
            --primary-color: var(--espam-primary);
            --secondary-color: var(--espam-secondary);
            --accent-color: var(--espam-accent);
            --light-color: var(--espam-light);
            --text-color: #333333;
            --border-color: #dee2e6;
            --error-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }
        
        /* ===== TIPOGRAFÍA SEGÚN NORMATIVA ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* Work Sans como fuente principal para entornos digitales */
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 400;
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, 
                rgba(0, 88, 70, 0.08) 0%, 
                rgba(55, 179, 74, 0.08) 50%, 
                rgba(203, 219, 42, 0.08) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* Libertinus Mono para encabezados (similar a Libertad Mono) */
        h1, h2, h3, h4, h5, h6,
        .login-header h1,
        .register-box h2,
        .btn-register-submit,
        .form-step h3 {
            font-family: 'Libertinus Mono', 'Courier New', monospace;
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        /* ===== CONTENEDOR PRINCIPAL ===== */
        .login-container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            min-height: 700px;
        }
        
        /* ===== HEADER CON LOGOTIPO ===== */
        .login-header {
            background: linear-gradient(135deg, var(--espam-primary) 0%, var(--espam-dark) 100%);
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        /* Patrón de fondo sutil */
        .login-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(203, 219, 42, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(8, 184, 157, 0.1) 0%, transparent 50%);
            z-index: 0;
        }
        
        .login-logo {
            width: 150px;
            height: auto;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .login-header h1 {
            color: white;
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .login-header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            font-weight: 300;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }
        
        /* ===== CONTENIDO DEL REGISTRO ===== */
        .register-box {
            padding: 40px;
            position: relative;
        }
        
        /* Barra de progreso */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .progress-bar::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--border-color);
            transform: translateY(-50%);
            z-index: 0;
        }
        
        .progress-step {
            position: relative;
            z-index: 1;
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Libertinus Mono', monospace;
            font-weight: 700;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .progress-step.active {
            border-color: var(--espam-primary);
            background: var(--espam-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 88, 70, 0.3);
        }
        
        .progress-step.completed {
            border-color: var(--espam-secondary);
            background: var(--espam-secondary);
            color: white;
        }
        
        .progress-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }
        
        .register-box h2 {
            color: var(--espam-primary);
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }
        
        .register-box h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: var(--espam-accent);
            border-radius: 2px;
        }
        
        /* ===== FORMULARIO MULTIPASO ===== */
        #registerForm {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-step {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-step h3 {
            color: var(--espam-primary);
            font-size: 1.3rem;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--espam-light);
        }
        
        .form-step h3 i {
            color: var(--espam-accent2);
        }
        
        /* ===== DISEÑO DE FORMULARIO ===== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-family: 'Libertinus Mono', monospace;
            font-weight: 700;
            color: var(--espam-primary);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .form-group label i {
            margin-right: 8px;
            color: var(--espam-accent2);
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
            font-style: italic;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1rem;
            color: var(--text-color);
            background: white;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--espam-accent);
            box-shadow: 0 0 0 3px rgba(203, 219, 42, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: var(--error-color);
        }
        
        .form-group input.success,
        .form-group select.success,
        .form-group textarea.success {
            border-color: var(--success-color);
        }
        
        .form-group input.warning,
        .form-group select.warning,
        .form-group textarea.warning {
            border-color: var(--warning-color);
        }
        
        /* ===== CHECKBOX PERSONALIZADO ===== */
        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-color);
            font-family: 'Work Sans', sans-serif;
            margin-top: 10px;
        }
        
        .checkbox-container input {
            display: none;
        }
        
        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-right: 10px;
            position: relative;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .checkbox-container input:checked + .checkmark {
            background: var(--espam-primary);
            border-color: var(--espam-primary);
        }
        
        .checkbox-container input:checked + .checkmark::after {
            content: "✓";
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .terms-link {
            color: var(--espam-primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .terms-link:hover {
            text-decoration: underline;
            color: var(--espam-accent2);
        }
        
        /* ===== INDICADOR DE FUERZA DE CONTRASEÑA ===== */
        .password-strength {
            margin-top: 10px;
        }
        
        .strength-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
            position: relative;
        }
        
        .strength-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: var(--error-color);
            transition: all 0.3s ease;
            border-radius: 3px;
        }
        
        .strength-bar.weak::after {
            width: 33%;
            background: var(--error-color);
        }
        
        .strength-bar.medium::after {
            width: 66%;
            background: var(--warning-color);
        }
        
        .strength-bar.strong::after {
            width: 100%;
            background: var(--success-color);
        }
        
        .strength-text {
            font-size: 0.85rem;
            color: #666;
            display: block;
        }
        
        /* ===== BOTONES DEL FORMULARIO ===== */
        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }
        
        .btn-prev,
        .btn-next,
        .btn-register-submit {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-family: 'Libertinus Mono', monospace;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-width: 150px;
            justify-content: center;
        }
        
        .btn-prev {
            background: white;
            color: var(--espam-primary);
            border: 2px solid var(--espam-primary);
        }
        
        .btn-prev:hover {
            background: rgba(0, 88, 70, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 88, 70, 0.1);
        }
        
        .btn-next {
            background: linear-gradient(135deg, var(--espam-primary) 0%, var(--espam-dark) 100%);
            color: white;
        }
        
        .btn-next:hover {
            background: linear-gradient(135deg, var(--espam-dark) 0%, var(--espam-primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 88, 70, 0.2);
        }
        
        .btn-register-submit {
            background: linear-gradient(135deg, var(--espam-secondary) 0%, #2d9c3d 100%);
            color: white;
            box-shadow: 0 6px 12px rgba(55, 179, 74, 0.25);
        }
        
        .btn-register-submit:hover {
            background: linear-gradient(135deg, #2d9c3d 0%, var(--espam-secondary) 100%);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(55, 179, 74, 0.3);
        }
        
        .btn-register-submit:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Botón siguiente en pasos individuales */
        .btn-next:not(.form-buttons .btn-next) {
            margin-top: 30px;
            width: 100%;
        }
        
        /* ===== FOOTER DEL REGISTRO ===== */
        .register-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }
        
        .register-footer p {
            color: #666;
            font-size: 0.95rem;
        }
        
        .register-footer a {
            color: var(--espam-primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .register-footer a:hover {
            text-decoration: underline;
            color: var(--espam-accent2);
        }
        
        /* ===== MENSAJES DE VALIDACIÓN ===== */
        .validation-message {
            font-size: 0.85rem;
            margin-top: 5px;
            padding: 8px 12px;
            border-radius: 6px;
            display: none;
        }
        
        .validation-message.error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error-color);
            display: block;
            border-left: 3px solid var(--error-color);
        }
        
        .validation-message.success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            display: block;
            border-left: 3px solid var(--success-color);
        }
        
        .validation-message.warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
            display: block;
            border-left: 3px solid var(--warning-color);
        }
        
        /* ===== LOADING STATE ===== */
        .loading {
            position: relative;
            pointer-events: none;
        }
        
        .loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* ===== INDICADOR DE PASOS ===== */
        .step-indicator {
            display: inline-block;
            background: var(--espam-light);
            color: var(--espam-primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .login-container {
                max-width: 95%;
            }
            
            .login-header {
                padding: 30px 20px;
            }
            
            .login-logo {
                width: 120px;
            }
            
            .login-header h1 {
                font-size: 1.5rem;
            }
            
            .register-box {
                padding: 30px 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .progress-bar {
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
            }
            
            .progress-bar::before {
                display: none;
            }
            
            .form-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-prev,
            .btn-next,
            .btn-register-submit {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .register-box h2 {
                font-size: 1.5rem;
            }
            
            .form-step h3 {
                font-size: 1.1rem;
            }
        }
    </style>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
</head>
<body>
    <div class="login-container">
        <!-- Header con identidad ESPAM MFL -->
        <div class="login-header">
            <!-- Logotipo con área de protección -->
            <div style="padding: 12px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: inline-block;">
                <img src="https://via.placeholder.com/150x70/005846/FFFFFF?text=ESPAM+MFL" 
                     alt="Logo Universidad ESPAM MFL" 
                     class="login-logo">
            </div>
            
            <h1>UNIVERSIDAD ESPAM MFL</h1>
            <p>Unidad de Desarrollo e Investigación - Sistema de Gestión de Laboratorios</p>
        </div>
        
        <!-- Contenido del registro -->
        <div class="register-box">
            <h2>SOLICITUD DE REGISTRO <span class="step-indicator">PASO 1 DE 3</span></h2>
            
            <!-- Barra de progreso -->
            <div class="progress-bar">
                <div class="progress-step active" id="step1-progress">
                    1
                    <span class="progress-label">Datos Personales</span>
                </div>
                <div class="progress-step" id="step2-progress">
                    2
                    <span class="progress-label">Información Académica</span>
                </div>
                <div class="progress-step" id="step3-progress">
                    3
                    <span class="progress-label">Credenciales</span>
                </div>
            </div>
            
            <form id="registerForm">
                <!-- Paso 1: Información Personal -->
                <div class="form-step active" id="step1">
                    <h3><i class="fas fa-user-circle"></i> Información Personal</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombres">
                                <i class="fas fa-user"></i> Nombres *
                            </label>
                            <input type="text" id="nombres" name="nombres" 
                                   placeholder="Ej: Juan Carlos" required>
                            <div class="validation-message" id="nombresValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="apellidos">
                                <i class="fas fa-user"></i> Apellidos *
                            </label>
                            <input type="text" id="apellidos" name="apellidos" 
                                   placeholder="Ej: Pérez Rodríguez" required>
                            <div class="validation-message" id="apellidosValidation"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cedula">
                                <i class="fas fa-id-card"></i> Cédula/Identificación *
                            </label>
                            <input type="text" id="cedula" name="cedula" 
                                   placeholder="Ej: 1234567890" required
                                   pattern="[0-9]{10}" maxlength="10">
                            <small>Ingrese 10 dígitos sin guiones</small>
                            <div class="validation-message" id="cedulaValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="telefono">
                                <i class="fas fa-phone"></i> Teléfono/Celular *
                            </label>
                            <input type="tel" id="telefono" name="telefono" 
                                   placeholder="Ej: 0987654321" required
                                   pattern="[0-9]{10}" maxlength="10">
                            <div class="validation-message" id="telefonoValidation"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="sexo">
                                <i class="fas fa-venus-mars"></i> Sexo *
                            </label>
                            <select id="sexo" name="sexo" required>
                                <option value="">Seleccionar</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                                <option value="otro">Otro</option>
                                <option value="prefiero-no-decir">Prefiero no decir</option>
                            </select>
                            <div class="validation-message" id="sexoValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="fecha_nacimiento">
                                <i class="fas fa-birthday-cake"></i> Fecha de Nacimiento *
                            </label>
                            <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>
                            <div class="validation-message" id="fechaNacimientoValidation"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="discapacidad">
                            <i class="fas fa-wheelchair"></i> ¿Tiene alguna discapacidad o condición especial?
                        </label>
                        <textarea id="discapacidad" name="discapacidad" 
                                  placeholder="Especifique si tiene alguna condición que requiera atención especial (opcional)"></textarea>
                        <small>Esta información nos ayuda a brindar un mejor servicio y accesibilidad</small>
                    </div>

                    <button type="button" class="btn-next" onclick="nextStep(2)">
                        Continuar a Información Académica <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <!-- Paso 2: Información Académica -->
                <div class="form-step" id="step2">
                    <h3><i class="fas fa-graduation-cap"></i> Información Académica y Laboral</h3>
                    
                    <div class="form-group">
                        <label for="userType">
                            <i class="fas fa-user-tag"></i> Tipo de Usuario *
                        </label>
                        <select id="userType" name="userType" required>
                            <option value="">Seleccionar rol principal</option>
                            <option value="tecnico">Técnico Encargado</option>
                            <option value="docente">Docente</option>
                            <option value="estudiante">Estudiante</option>
                            <option value="investigador">Investigador</option>
                            <option value="administrativo">Personal Administrativo</option>
                        </select>
                        <small>Seleccione el rol principal con el que utilizará el sistema</small>
                        <div class="validation-message" id="userTypeValidation"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" id="carreraContainer">
                            <label for="carrera">
                                <i class="fas fa-book"></i> Carrera/Especialidad *
                            </label>
                            <select id="carrera" name="carrera">
                                <option value="">Seleccionar carrera</option>
                                <option value="produccion">Ingeniería de la Producción</option>
                                <option value="alimentos">Ingeniería en Alimentos</option>
                                <option value="ambiental">Ingeniería Ambiental</option>
                                <option value="agroindustrial">Ingeniería Agroindustrial</option>
                                <option value="biotecnologia">Biotecnología</option>
                                <option value="administracion">Administración de Empresas</option>
                                <option value="contabilidad">Contabilidad y Auditoría</option>
                                <option value="marketing">Marketing</option>
                                <option value="otra">Otra carrera/programa</option>
                            </select>
                            <div class="validation-message" id="carreraValidation"></div>
                        </div>

                        <div class="form-group">
                            <label for="semestre">
                                <i class="fas fa-calendar-alt"></i> Semestre/Nivel
                            </label>
                            <input type="text" id="semestre" name="semestre" 
                                   placeholder="Ej: 5to Semestre, 3er Nivel, Maestría">
                            <small>Para estudiantes, indique el semestre actual</small>
                        </div>
                    </div>

                    <div class="form-group" id="otraCarreraContainer" style="display: none;">
                        <label for="otra_carrera">
                            <i class="fas fa-pen"></i> Especifique su carrera/programa *
                        </label>
                        <input type="text" id="otra_carrera" name="otra_carrera" 
                               placeholder="Ej: Ingeniería en Sistemas">
                        <div class="validation-message" id="otraCarreraValidation"></div>
                    </div>

                    <div class="form-group" id="laboratorioContainer">
                        <label for="laboratorio_asignado">
                            <i class="fas fa-flask"></i> Laboratorio/Área Asignada
                        </label>
                        <select id="laboratorio_asignado" name="laboratorio_asignado">
                            <option value="">Seleccionar laboratorio/área</option>
                            <option value="bromatologia">Laboratorio de Bromatología</option>
                            <option value="biologia">Laboratorio de Biología</option>
                            <option value="produccion">Laboratorio de Producción</option>
                            <option value="quimica">Laboratorio de Química</option>
                            <option value="computacion">Laboratorio de Computación</option>
                            <option value="investigacion">Área de Investigación</option>
                            <option value="docencia">Área de Docencia</option>
                            <option value="administracion">Área Administrativa</option>
                            <option value="otro">Otro laboratorio/área</option>
                        </select>
                        <small>Para técnicos y docentes, indique su laboratorio principal</small>
                    </div>

                    <div class="form-group" id="otroLaboratorioContainer" style="display: none;">
                        <label for="otro_laboratorio">
                            <i class="fas fa-pen"></i> Especifique el laboratorio/área
                        </label>
                        <input type="text" id="otro_laboratorio" name="otro_laboratorio" 
                               placeholder="Ej: Laboratorio de Física">
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn-prev" onclick="prevStep(1)">
                            <i class="fas fa-arrow-left"></i> Volver a Datos Personales
                        </button>
                        <button type="button" class="btn-next" onclick="nextStep(3)">
                            Continuar a Credenciales <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Paso 3: Credenciales de Acceso -->
                <div class="form-step" id="step3">
                    <h3><i class="fas fa-key"></i> Credenciales de Acceso y Seguridad</h3>
                    
                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i> Correo Institucional *
                        </label>
                        <input type="email" id="email" name="email" 
                               placeholder="usuario@espam.edu.ec" required
                               pattern="[a-z0-9._%+-]+@espam\.edu\.ec$"
                               title="Use su correo institucional de la ESPAM MFL">
                        <small>Debe ser su correo institucional oficial de la ESPAM MFL</small>
                        <div class="validation-message" id="emailValidation"></div>
                    </div>

                    <div class="form-group">
                        <label for="email_personal">
                            <i class="fas fa-envelope"></i> Correo Personal (Recomendado)
                        </label>
                        <input type="email" id="email_personal" name="email_personal"
                               placeholder="correo.personal@gmail.com">
                        <small>Se utilizará para recuperación de contraseña y notificaciones importantes</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">
                                <i class="fas fa-lock"></i> Contraseña *
                            </label>
                            <input type="password" id="password" name="password" 
                                   placeholder="Mínimo 8 caracteres" required
                                   minlength="8">
                            <div class="password-strength">
                                <div class="strength-bar" id="strengthBar"></div>
                                <span class="strength-text" id="strengthText">Seguridad: Ingrese su contraseña</span>
                            </div>
                            <div class="validation-message" id="passwordValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">
                                <i class="fas fa-lock"></i> Confirmar Contraseña *
                            </label>
                            <input type="password" id="confirm_password" name="confirm_password" 
                                   placeholder="Repita su contraseña" required>
                            <div class="validation-message" id="confirmPasswordValidation"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" name="terms" id="terms" required>
                            <span class="checkmark"></span>
                            He leído y acepto los <a href="#" class="terms-link" onclick="showTerms()">términos y condiciones de uso</a> 
                            y la <a href="#" class="terms-link" onclick="showPrivacy()">política de privacidad y protección de datos</a> de la ESPAM MFL
                        </label>
                        <div class="validation-message" id="termsValidation"></div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" name="newsletter" id="newsletter">
                            <span class="checkmark"></span>
                            Deseo recibir notificaciones sobre novedades, actualizaciones y capacitaciones del sistema
                        </label>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn-prev" onclick="prevStep(2)">
                            <i class="fas fa-arrow-left"></i> Volver a Información Académica
                        </button>
                        <button type="submit" class="btn-register-submit" id="submitButton">
                            <i class="fas fa-user-plus"></i> ENVIAR SOLICITUD DE REGISTRO
                        </button>
                    </div>
                </div>
            </form>

            <div class="register-footer">
                <p>¿Ya tiene una cuenta en el sistema? <a href="login.html">Inicie sesión aquí</a></p>
                <p>Para consultas sobre el registro, contacte al administrador: <a href="mailto:soporte.udiv@espam.edu.ec">soporte.udiv@espam.edu.ec</a></p>
            </div>
        </div>
    </div>

    <script>
        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos del formulario
            setupFormEvents();
            
            // Configurar validaciones en tiempo real
            setupRealTimeValidation();
            
            // Inicializar controles dinámicos
            initDynamicControls();
            
            // Configurar fecha máxima para nacimiento (18 años mínimo)
            const fechaInput = document.getElementById('fecha_nacimiento');
            const hoy = new Date();
            const fechaMaxima = new Date(hoy.getFullYear() - 18, hoy.getMonth(), hoy.getDate());
            fechaInput.max = fechaMaxima.toISOString().split('T')[0];
            fechaInput.min = '1900-01-01';
        });
        
        // ===== NAVEGACIÓN ENTRE PASOS =====
        let currentStep = 1;
        
        function nextStep(step) {
            if (!validateStep(currentStep)) {
                return;
            }
            
            // Ocultar paso actual
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}-progress`).classList.remove('active');
            
            // Marcar paso actual como completado
            document.getElementById(`step${currentStep}-progress`).classList.add('completed');
            
            // Mostrar siguiente paso
            currentStep = step;
            document.getElementById(`step${step}`).classList.add('active');
            document.getElementById(`step${step}-progress`).classList.add('active');
            
            // Actualizar indicador en el título
            updateStepIndicator();
            
            // Scroll al inicio del formulario
            document.querySelector('.register-box').scrollTop = 0;
        }
        
        function prevStep(step) {
            // Ocultar paso actual
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}-progress`).classList.remove('active');
            
            // Quitar marca de completado del paso que estamos dejando
            document.getElementById(`step${currentStep}-progress`).classList.remove('completed');
            
            // Mostrar paso anterior
            currentStep = step;
            document.getElementById(`step${step}`).classList.add('active');
            document.getElementById(`step${step}-progress`).classList.add('active');
            
            // Actualizar indicador en el título
            updateStepIndicator();
            
            // Scroll al inicio del formulario
            document.querySelector('.register-box').scrollTop = 0;
        }
        
        function updateStepIndicator() {
            const indicator = document.querySelector('.step-indicator');
            indicator.textContent = `PASO ${currentStep} DE 3`;
        }
        
        // ===== VALIDACIÓN DE PASOS =====
        function validateStep(step) {
            let isValid = true;
            
            switch(step) {
                case 1:
                    isValid = validateStep1();
                    break;
                case 2:
                    isValid = validateStep2();
                    break;
                case 3:
                    isValid = validateStep3();
                    break;
            }
            
            return isValid;
        }
        
        function validateStep1() {
            let isValid = true;
            
            // Validar nombres
            const nombres = document.getElementById('nombres').value.trim();
            if (!nombres) {
                showValidation('nombresValidation', 'Los nombres son requeridos', 'error');
                isValid = false;
            } else if (nombres.length < 2) {
                showValidation('nombresValidation', 'Los nombres deben tener al menos 2 caracteres', 'error');
                isValid = false;
            } else {
                showValidation('nombresValidation', 'Nombres válidos', 'success');
            }
            
            // Validar apellidos
            const apellidos = document.getElementById('apellidos').value.trim();
            if (!apellidos) {
                showValidation('apellidosValidation', 'Los apellidos son requeridos', 'error');
                isValid = false;
            } else if (apellidos.length < 2) {
                showValidation('apellidosValidation', 'Los apellidos deben tener al menos 2 caracteres', 'error');
                isValid = false;
            } else {
                showValidation('apellidosValidation', 'Apellidos válidos', 'success');
            }
            
            // Validar cédula
            const cedula = document.getElementById('cedula').value.trim();
            const cedulaRegex = /^[0-9]{10}$/;
            if (!cedula) {
                showValidation('cedulaValidation', 'La cédula es requerida', 'error');
                isValid = false;
            } else if (!cedulaRegex.test(cedula)) {
                showValidation('cedulaValidation', 'La cédula debe tener 10 dígitos numéricos', 'error');
                isValid = false;
            } else {
                showValidation('cedulaValidation', 'Cédula válida', 'success');
            }
            
            // Validar teléfono
            const telefono = document.getElementById('telefono').value.trim();
            const telefonoRegex = /^[0-9]{10}$/;
            if (!telefono) {
                showValidation('telefonoValidation', 'El teléfono es requerido', 'error');
                isValid = false;
            } else if (!telefonoRegex.test(telefono)) {
                showValidation('telefonoValidation', 'El teléfono debe tener 10 dígitos', 'error');
                isValid = false;
            } else {
                showValidation('telefonoValidation', 'Teléfono válido', 'success');
            }
            
            // Validar sexo
            const sexo = document.getElementById('sexo').value;
            if (!sexo) {
                showValidation('sexoValidation', 'El sexo es requerido', 'error');
                isValid = false;
            } else {
                showValidation('sexoValidation', 'Sexo seleccionado', 'success');
            }
            
            // Validar fecha de nacimiento
            const fechaNacimiento = document.getElementById('fecha_nacimiento').value;
            if (!fechaNacimiento) {
                showValidation('fechaNacimientoValidation', 'La fecha de nacimiento es requerida', 'error');
                isValid = false;
            } else {
                const fechaNac = new Date(fechaNacimiento);
                const hoy = new Date();
                const edad = hoy.getFullYear() - fechaNac.getFullYear();
                if (edad < 18) {
                    showValidation('fechaNacimientoValidation', 'Debe ser mayor de 18 años', 'error');
                    isValid = false;
                } else {
                    showValidation('fechaNacimientoValidation', 'Fecha válida', 'success');
                }
            }
            
            return isValid;
        }
        
        function validateStep2() {
            let isValid = true;
            
            // Validar tipo de usuario
            const userType = document.getElementById('userType').value;
            if (!userType) {
                showValidation('userTypeValidation', 'El tipo de usuario es requerido', 'error');
                isValid = false;
            } else {
                showValidation('userTypeValidation', 'Tipo de usuario seleccionado', 'success');
            }
            
            // Validar carrera (si aplica)
            const carrera = document.getElementById('carrera').value;
            const otraCarrera = document.getElementById('otra_carrera').value;
            const otraCarreraContainer = document.getElementById('otraCarreraContainer');
            
            if (userType === 'estudiante' || userType === 'docente') {
                if (!carrera) {
                    showValidation('carreraValidation', 'La carrera es requerida', 'error');
                    isValid = false;
                } else if (carrera === 'otra' && !otraCarrera) {
                    showValidation('otraCarreraValidation', 'Debe especificar su carrera', 'error');
                    isValid = false;
                } else {
                    showValidation('carreraValidation', 'Carrera válida', 'success');
                    if (carrera === 'otra') {
                        showValidation('otraCarreraValidation', 'Carrera especificada', 'success');
                    }
                }
            }
            
            return isValid;
        }
        
        function validateStep3() {
            let isValid = true;
            
            // Validar email institucional
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[a-z0-9._%+-]+@espam\.edu\.ec$/i;
            if (!email) {
                showValidation('emailValidation', 'El correo institucional es requerido', 'error');
                isValid = false;
            } else if (!emailRegex.test(email)) {
                showValidation('emailValidation', 'Debe usar su correo institucional @espam.edu.ec', 'error');
                isValid = false;
            } else {
                showValidation('emailValidation', 'Correo institucional válido', 'success');
            }
            
            // Validar contraseña
            const password = document.getElementById('password').value;
            if (!password) {
                showValidation('passwordValidation', 'La contraseña es requerida', 'error');
                isValid = false;
            } else if (password.length < 8) {
                showValidation('passwordValidation', 'La contraseña debe tener al menos 8 caracteres', 'error');
                isValid = false;
            } else {
                showValidation('passwordValidation', 'Contraseña válida', 'success');
            }
            
            // Validar confirmación de contraseña
            const confirmPassword = document.getElementById('confirm_password').value;
            if (!confirmPassword) {
                showValidation('confirmPasswordValidation', 'Debe confirmar su contraseña', 'error');
                isValid = false;
            } else if (password !== confirmPassword) {
                showValidation('confirmPasswordValidation', 'Las contraseñas no coinciden', 'error');
                isValid = false;
            } else {
                showValidation('confirmPasswordValidation', 'Contraseñas coinciden', 'success');
            }
            
            // Validar términos y condiciones
            const terms = document.getElementById('terms').checked;
            if (!terms) {
                showValidation('termsValidation', 'Debe aceptar los términos y condiciones', 'error');
                isValid = false;
            } else {
                showValidation('termsValidation', 'Términos aceptados', 'success');
            }
            
            return isValid;
        }
        
        // ===== CONFIGURACIÓN DE EVENTOS =====
        function setupFormEvents() {
            const form = document.getElementById('registerForm');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateStep3()) {
                    submitRegistration();
                }
            });
        }
        
        function setupRealTimeValidation() {
            // Validación en tiempo real para paso 1
            document.getElementById('nombres').addEventListener('input', function() {
                validateField(this, 'nombresValidation', value => value.length >= 2, 'Los nombres deben tener al menos 2 caracteres');
            });
            
            document.getElementById('cedula').addEventListener('input', function() {
                const cedulaRegex = /^[0-9]{0,10}$/;
                if (!cedulaRegex.test(this.value)) {
                    this.value = this.value.slice(0, -1);
                }
                validateField(this, 'cedulaValidation', value => /^[0-9]{10}$/.test(value), 'La cédula debe tener 10 dígitos');
            });
            
            document.getElementById('telefono').addEventListener('input', function() {
                const telefonoRegex = /^[0-9]{0,10}$/;
                if (!telefonoRegex.test(this.value)) {
                    this.value = this.value.slice(0, -1);
                }
                validateField(this, 'telefonoValidation', value => /^[0-9]{10}$/.test(value), 'El teléfono debe tener 10 dígitos');
            });
            
            // Validación de contraseña en tiempo real
            document.getElementById('password').addEventListener('input', function() {
                checkPasswordStrength(this.value);
                validateField(this, 'passwordValidation', value => value.length >= 8, 'Mínimo 8 caracteres');
            });
            
            document.getElementById('confirm_password').addEventListener('input', function() {
                const password = document.getElementById('password').value;
                validateField(this, 'confirmPasswordValidation', value => value === password, 'Las contraseñas no coinciden');
            });
            
            // Validación de email institucional
            document.getElementById('email').addEventListener('input', function() {
                const emailRegex = /^[a-z0-9._%+-]+@espam\.edu\.ec$/i;
                validateField(this, 'emailValidation', value => emailRegex.test(value), 'Use su correo institucional @espam.edu.ec');
            });
        }
        
        function validateField(input, validationId, validationFn, errorMessage) {
            const value = input.value.trim();
            const validationDiv = document.getElementById(validationId);
            
            if (!value) {
                input.classList.remove('success', 'error', 'warning');
                validationDiv.textContent = '';
                validationDiv.className = 'validation-message';
                return;
            }
            
            if (validationFn(value)) {
                input.classList.remove('error', 'warning');
                input.classList.add('success');
                showValidation(validationId, 'Válido', 'success');
            } else {
                input.classList.remove('success', 'warning');
                input.classList.add('error');
                showValidation(validationId, errorMessage, 'error');
            }
        }
        
        function showValidation(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'validation-message ' + type;
        }
        
        // ===== CONTROLES DINÁMICOS =====
        function initDynamicControls() {
            // Mostrar/ocultar campo de otra carrera
            document.getElementById('carrera').addEventListener('change', function() {
                const otraCarreraContainer = document.getElementById('otraCarreraContainer');
                if (this.value === 'otra') {
                    otraCarreraContainer.style.display = 'block';
                } else {
                    otraCarreraContainer.style.display = 'none';
                    document.getElementById('otra_carrera').value = '';
                }
            });
            
            // Mostrar/ocultar campo de otro laboratorio
            document.getElementById('laboratorio_asignado').addEventListener('change', function() {
                const otroLaboratorioContainer = document.getElementById('otroLaboratorioContainer');
                if (this.value === 'otro') {
                    otroLaboratorioContainer.style.display = 'block';
                } else {
                    otroLaboratorioContainer.style.display = 'none';
                    document.getElementById('otro_laboratorio').value = '';
                }
            });
            
            // Mostrar/ocultar campos según tipo de usuario
            document.getElementById('userType').addEventListener('change', function() {
                const carreraContainer = document.getElementById('carreraContainer');
                const laboratorioContainer = document.getElementById('laboratorioContainer');
                
                if (this.value === 'estudiante' || this.value === 'docente') {
                    carreraContainer.style.display = 'block';
                    laboratorioContainer.style.display = 'block';
                } else if (this.value === 'tecnico') {
                    carreraContainer.style.display = 'none';
                    laboratorioContainer.style.display = 'block';
                } else {
                    carreraContainer.style.display = 'none';
                    laboratorioContainer.style.display = 'none';
                }
            });
        }
        
        // ===== ANÁLISIS DE FUERZA DE CONTRASEÑA =====
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            let strength = 0;
            let tips = "";
            
            // Verificar longitud
            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 25;
            
            // Verificar caracteres especiales
            if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) strength += 25;
            
            // Verificar números
            if (/[0-9]/.test(password)) strength += 15;
            
            // Verificar mayúsculas y minúsculas
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 10;
            
            // Determinar nivel de seguridad
            if (strength >= 75) {
                strengthBar.className = 'strength-bar strong';
                strengthText.textContent = 'Seguridad: Excelente';
                strengthText.style.color = 'var(--success-color)';
            } else if (strength >= 50) {
                strengthBar.className = 'strength-bar medium';
                strengthText.textContent = 'Seguridad: Buena';
                strengthText.style.color = 'var(--warning-color)';
            } else if (strength >= 25) {
                strengthBar.className = 'strength-bar weak';
                strengthText.textContent = 'Seguridad: Débil';
                strengthText.style.color = 'var(--error-color)';
            } else {
                strengthBar.className = 'strength-bar';
                strengthText.textContent = 'Seguridad: Ingrese su contraseña';
                strengthText.style.color = '#666';
            }
        }
        
        // ===== ENVÍO DEL REGISTRO =====
        function submitRegistration() {
            const submitButton = document.getElementById('submitButton');
            
            // Mostrar estado de loading
            submitButton.disabled = true;
            submitButton.classList.add('loading');
            submitButton.innerHTML = '';
            
            // Recopilar datos del formulario
            const formData = {
                nombres: document.getElementById('nombres').value.trim(),
                apellidos: document.getElementById('apellidos').value.trim(),
                cedula: document.getElementById('cedula').value.trim(),
                telefono: document.getElementById('telefono').value.trim(),
                sexo: document.getElementById('sexo').value,
                fecha_nacimiento: document.getElementById('fecha_nacimiento').value,
                discapacidad: document.getElementById('discapacidad').value.trim(),
                userType: document.getElementById('userType').value,
                carrera: document.getElementById('carrera').value,
                otra_carrera: document.getElementById('otra_carrera').value.trim(),
                semestre: document.getElementById('semestre').value.trim(),
                laboratorio_asignado: document.getElementById('laboratorio_asignado').value,
                otro_laboratorio: document.getElementById('otro_laboratorio').value.trim(),
                email: document.getElementById('email').value.trim(),
                email_personal: document.getElementById('email_personal').value.trim(),
                password: document.getElementById('password').value,
                terms: document.getElementById('terms').checked,
                newsletter: document.getElementById('newsletter').checked
            };
            
            // Simular envío al servidor
            setTimeout(() => {
                submitButton.disabled = false;
                submitButton.classList.remove('loading');
                submitButton.innerHTML = '<i class="fas fa-user-plus"></i> ENVIAR SOLICITUD DE REGISTRO';
                
                // Mostrar mensaje de éxito
                alert(`¡Solicitud de registro enviada exitosamente!\n\nHola ${formData.nombres}, tu solicitud de registro como ${formData.userType} ha sido recibida. El administrador del sistema revisará tu información y te notificará cuando tu cuenta sea activada.`);
                
                // En producción, aquí se enviaría al servidor
                console.log('Datos del registro:', formData);
                
                // Redirigir a página de confirmación (simulado)
                // window.location.href = 'registro-exitoso.html';
                
            }, 2000);
        }
        
        // ===== FUNCIONES AUXILIARES =====
        function showTerms() {
            alert('TÉRMINOS Y CONDICIONES\n\nAl usar el sistema de gestión de laboratorios de la ESPAM MFL, usted acepta:\n\n1. Usar el sistema solo para fines académicos e institucionales.\n2. Mantener la confidencialidad de sus credenciales.\n3. No compartir información sensible del sistema.\n4. Cumplir con las políticas de uso de laboratorios.\n5. Reportar cualquier irregularidad al administrador.');
        }
        
        function showPrivacy() {
            alert('POLÍTICA DE PRIVACIDAD\n\nLa ESPAM MFL protege sus datos personales:\n\n1. Solo recolectamos información necesaria para el funcionamiento del sistema.\n2. No compartimos su información con terceros sin su consentimiento.\n3. Sus datos se almacenan de forma segura.\n4. Puede solicitar la modificación o eliminación de sus datos.\n5. Usamos sus datos solo para fines institucionales.');
        }
        
        // ===== FUNCIONALIDADES ADICIONALES =====
        // Auto-formato de nombres
        document.getElementById('nombres').addEventListener('blur', function() {
            this.value = this.value.trim().replace(/\b\w/g, l => l.toUpperCase());
        });
        
        document.getElementById('apellidos').addEventListener('blur', function() {
            this.value = this.value.trim().replace(/\b\w/g, l => l.toUpperCase());
        });
        
        // Auto-completar email institucional basado en nombres y apellidos
        document.getElementById('nombres').addEventListener('blur', function() {
            const apellidos = document.getElementById('apellidos').value.trim();
            const emailInput = document.getElementById('email');
            
            if (this.value && apellidos && !emailInput.value) {
                const nombreBase = this.value.toLowerCase().split(' ')[0];
                const apellidoBase = apellidos.toLowerCase().split(' ')[0];
                emailInput.value = `${nombreBase}.${apellidoBase}@espam.edu.ec`;
            }
        });
    </script>
</body>
</html>